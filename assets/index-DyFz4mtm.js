import{j as t,r as i}from"./react-C0JOplFJ.js";import{R as Je}from"./react-dom-CqXdU6rh.js";import{B as $e}from"./react-router-dom-Cpd4U8dH.js";import{I as Be,n as R,_ as k}from"./react-hot-toast-CSyfbE95.js";import{l as Ve}from"./socket.io-client-pgtUPCnp.js";import{L as Xe,a as ee,b as qe,c as Qe,R as Ke,d as Ze,e as et,A as tt,f as nt,P as Ce,M as be,T as st,B as rt,g as ye,I as ot,G as it,h as at,i as lt,j as ct,k as ut,l as dt,m as mt,n as ft,o as pt,p as ht}from"./react-icons-C4G2qDgB.js";import{v as U}from"./uuid-CtRu48qb.js";import{a as Ee}from"./axios-BtuGy7By.js";import{F as xt}from"./file-saver-Djip2q1l.js";import{J as gt}from"./jszip-CtSIKovu.js";import{M as wt}from"./react-markdown-jH1aUftD.js";import{h as Ct,d as bt}from"./react-syntax-highlighter-DiSsqK0z.js";import{I as yt}from"./vscode-icons-js-Chox8ZBA.js";import{I as Ne}from"./@iconify-zFJnPiHX.js";import{c as J}from"./classnames-C5re8Ct7.js";import{l as ve}from"./lang-map-nLg5Kdxm.js";import{x as Et,a as Nt,w as vt,b as jt,v as St,t as Dt,c as It,d as kt,e as Rt,s as Lt,f as Tt,g as Ot,r as Ft,q as At,o as Pt,n as _t,h as Ut,m as Mt,i as zt,j as Ht,k as Gt,l as Yt,p as Wt,u as Jt,y as $t,z as Bt,A as Vt,B as Xt,C as qt,D as Qt,E as Kt,F as Zt,G as en,H as tn,I as nn,J as sn,K as rn,L as on,M as an,N as ln,O as cn,P as un,Q as dn,R as mn,S as fn,T as pn,U as hn,V as xn}from"./@uiw-WkLdt38L.js";import{A as gn}from"./react-avatar-C7zsmaTv.js";import{u as X,a as wn,b as je,c as Cn,d as me}from"./react-router-B-SxGiBD.js";import{S as bn}from"./react-split-CyJlspd4.js";import{M as Se}from"./react-tooltip-DEIaoqXy.js";import{T as yn}from"./tldraw-pbfXqsY2.js";import{u as En}from"./@tldraw-DPVKUOq8.js";import"./lodash.isequal-CWPzDpkQ.js";import"./lodash.throttle-yuuEgjvB.js";import"./idb-Bn1DMRyg.js";import"./lodash.uniq-BHEsPF9E.js";import"./core-js-Dkw2Z0CP.js";import"./lz-string-CzHELm9r.js";import"./hotkeys-js-BfWqkGRU.js";import{E as Nn,bV as vn,bW as jn,bX as Sn}from"./@codemirror-BpdYY518.js";import{s as fe}from"./screenfull-DmVOzVZz.js";import"./charenc-CI8Jn5z4.js";import"./scheduler-C323NY8X.js";import"./@remix-run-DaH1AUis.js";import"./goober-vt3s6TGe.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./devlop-Cl3hj7Sz.js";import"./unified-BW-7GApn.js";import"./bail-FqpXQuLt.js";import"./extend-D1C0LVzC.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-B_b8ryxu.js";import"./vfile-tbz-BywF.js";import"./vfile-message-Bq256rVA.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./remark-parse-C8jcMe6G.js";import"./mdast-util-from-markdown-CgCUhJTR.js";import"./micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./micromark-util-decode-string-strjl-tx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-DhRKOnvZ.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-CA-Wq7KA.js";import"./micromark-util-character-Ch8j4vtg.js";import"./micromark-core-commonmark-CDnWrFBr.js";import"./micromark-util-classify-character-GCpR5yWH.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./micromark-util-subtokenize-BC4BSQ9J.js";import"./micromark-factory-destination-CkgxUJuk.js";import"./micromark-factory-label-U15tx9Nh.js";import"./micromark-factory-title-reCpaPbc.js";import"./micromark-factory-whitespace-_v4v79HM.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./mdast-util-to-string-C_aolqmU.js";import"./remark-rehype-C7cpKZXR.js";import"./mdast-util-to-hast--qmxlI7R.js";import"./@ungap-DDJC10qW.js";import"./micromark-util-sanitize-uri-WGc3xW3f.js";import"./unist-util-position-60F3QETU.js";import"./trim-lines-D8znQY54.js";import"./unist-util-visit-C5MGqtgf.js";import"./unist-util-visit-parents-BC5uWo4u.js";import"./unist-util-is-D9KQvrmg.js";import"./hast-util-to-jsx-runtime-BLSwkn7M.js";import"./comma-separated-tokens-xMQ5YY98.js";import"./property-information-Bcl-LqRA.js";import"./space-separated-tokens-DD3iYX1K.js";import"./style-to-js-CDqmnN_d.js";import"./style-to-object-Oc--562q.js";import"./inline-style-parser-D4u_cg7q.js";import"./hast-util-whitespace-D4Wp6AEg.js";import"./estree-util-is-identifier-name-BgBfM8ME.js";import"./html-url-attributes-D46m5wfe.js";import"./@babel-BM-RmR6T.js";import"./refractor-BVbasmXx.js";import"./hastscript-Cxyc55ZY.js";import"./xtend-VQg9yHl6.js";import"./hast-util-parse-selector-BXt8oe2z.js";import"./@lezer-Csp4QB38.js";import"./codemirror-lang-mermaid-Dj1uYUBd.js";import"./@replit-KKUtuZUK.js";import"./@nextjournal-BDO3jsR6.js";import"./colors-named-CSGyx1iI.js";import"./colors-named-hex-Db6HdBCI.js";import"./hsl-matcher-CyxH9sTP.js";import"./core-js-pure-C4mLA_hu.js";import"./prop-types-yNpOvJnk.js";import"./is-retina-BzLP6e3E.js";import"./md5-BDDM8jU4.js";import"./crypt-VTvMai_Y.js";import"./is-buffer-DMJNLjvk.js";import"./split.js-CPyVEc61.js";import"./@floating-ui-C8o30Yd9.js";import"./@radix-ui-DbwEOBZe.js";import"./react-remove-scroll-CjY7KAXu.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-Bft53YsI.js";import"./react-style-singleton-Ve9apNMX.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-CJ33BHOn.js";import"./use-callback-ref-CcqRhUnC.js";import"./aria-hidden-DQ5UC2Eg.js";import"./canvas-size-BJ7hgjqk.js";import"./@use-gesture-yVpL0cNb.js";import"./eventemitter3-D4IiiiOJ.js";import"./crelt-C8TCjufn.js";import"./style-mod-gVpFNjS1.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();function Dn(){return t.jsx(Be,{position:"top-right"})}var H=(e=>(e.CODING="coding",e.DRAWING="drawing",e))(H||{}),V=(e=>(e.OFFLINE="offline",e.ONLINE="online",e))(V||{}),F=(e=>(e.INITIAL="initial",e.CONNECTING="connecting",e.ATTEMPTING_JOIN="attempting-join",e.JOINED="joined",e.CONNECTION_FAILED="connection-failed",e.DISCONNECTED="disconnected",e))(F||{});const De=i.createContext(null),T=()=>{const e=i.useContext(De);if(e===null)throw new Error("useAppContext must be used within a AppContextProvider");return e};function In({children:e}){const[n,s]=i.useState([]),[r,o]=i.useState(F.INITIAL),[a,d]=i.useState({username:"",roomId:""}),[c,l]=i.useState(H.CODING),[u,h]=i.useState(null);return t.jsx(De.Provider,{value:{users:n,setUsers:s,currentUser:a,setCurrentUser:d,status:r,setStatus:o,activityState:c,setActivityState:l,drawingData:u,setDrawingData:h},children:e})}var C=(e=>(e.JOIN_REQUEST="join-request",e.JOIN_ACCEPTED="join-accepted",e.USER_JOINED="user-joined",e.USER_DISCONNECTED="user-disconnected",e.SYNC_FILE_STRUCTURE="sync-file-structure",e.DIRECTORY_CREATED="directory-created",e.DIRECTORY_UPDATED="directory-updated",e.DIRECTORY_RENAMED="directory-renamed",e.DIRECTORY_DELETED="directory-deleted",e.FILE_CREATED="file-created",e.FILE_UPDATED="file-updated",e.FILE_RENAMED="file-renamed",e.FILE_DELETED="file-deleted",e.USER_OFFLINE="offline",e.USER_ONLINE="online",e.SEND_MESSAGE="send-message",e.RECEIVE_MESSAGE="receive-message",e.TYPING_START="typing-start",e.TYPING_PAUSE="typing-pause",e.USERNAME_EXISTS="username-exists",e.REQUEST_DRAWING="request-drawing",e.SYNC_DRAWING="sync-drawing",e.DRAWING_UPDATE="drawing-update",e))(C||{});const Ie=i.createContext(null),M=()=>{const e=i.useContext(Ie);if(!e)throw new Error("useSocket must be used within a SocketProvider");return e},kn="http://localhost:3000",Rn=({children:e})=>{const{users:n,setUsers:s,setStatus:r,setCurrentUser:o,drawingData:a,setDrawingData:d}=T(),c=i.useMemo(()=>Ve(kn,{reconnectionAttempts:2}),[]),l=i.useCallback(p=>{console.log("socket error",p),r(F.CONNECTION_FAILED),R.dismiss(),R.error("Failed to connect to the server")},[r]),u=i.useCallback(()=>{R.dismiss(),r(F.INITIAL),R.error("The username you chose already exists in the room. Please choose a different username.")},[r]),h=i.useCallback(({user:p,users:y})=>{o(p),s(y),R.dismiss(),r(F.JOINED),y.length>1&&R.loading("Syncing data, please wait...")},[o,r,s]),g=i.useCallback(({user:p})=>{R.success(`${p.username} left the room`),s(n.filter(y=>y.username!==p.username))},[s,n]),f=i.useCallback(({socketId:p})=>{c.emit(C.SYNC_DRAWING,{socketId:p,drawingData:a})},[a,c]),m=i.useCallback(({drawingData:p})=>{d(p)},[d]);return i.useEffect(()=>(c.on("connect_error",l),c.on("connect_failed",l),c.on(C.USERNAME_EXISTS,u),c.on(C.JOIN_ACCEPTED,h),c.on(C.USER_DISCONNECTED,g),c.on(C.REQUEST_DRAWING,f),c.on(C.SYNC_DRAWING,m),()=>{c.off("connect_error"),c.off("connect_failed"),c.off(C.USERNAME_EXISTS),c.off(C.JOIN_ACCEPTED),c.off(C.USER_DISCONNECTED),c.off(C.REQUEST_DRAWING),c.off(C.SYNC_DRAWING)}),[m,l,h,f,g,u,s,c]),t.jsx(Ie.Provider,{value:{socket:c},children:e})},ke=i.createContext(null),te=()=>{const e=i.useContext(ke);if(!e)throw new Error("useChatRoom must be used within a ChatContextProvider");return e};function Ln({children:e}){const{socket:n}=M(),[s,r]=i.useState([]),[o,a]=i.useState(!1),[d,c]=i.useState(0);return i.useEffect(()=>(n.on(C.RECEIVE_MESSAGE,({message:l})=>{r(u=>[...u,l]),a(!0)}),()=>{n.off(C.RECEIVE_MESSAGE)}),[n]),t.jsx(ke.Provider,{value:{messages:s,setMessages:r,isNewMessage:o,setIsNewMessage:a,lastScrollHeight:d,setLastScrollHeight:c},children:e})}function Tn(e){const n=new Date(e);let s=n.getHours();const r=String(n.getMinutes()).padStart(2,"0"),o=s>=12?"PM":"AM";return s=s%12,s=s||12,`${s}:${r} ${o}`}function On(){const{currentUser:e}=T(),{socket:n}=M(),{setMessages:s}=te(),r=i.useRef(null),o=a=>{var c;a.preventDefault();const d=(c=r.current)==null?void 0:c.value.trim();if(d&&d.length>0){const l={id:U(),message:d,username:e.username,timestamp:Tn(new Date().toISOString())};n.emit(C.SEND_MESSAGE,{message:l}),s(u=>[...u,l]),r.current&&(r.current.value="")}};return t.jsxs("form",{onSubmit:o,className:"flex justify-between rounded-md border border-primary",children:[t.jsx("input",{type:"text",className:"w-full flex-grow rounded-md border-none bg-dark p-2 outline-none",placeholder:"Enter a message...",ref:r}),t.jsx("button",{className:"flex items-center justify-center rounded-r-md  bg-primary p-2 text-black",type:"submit",children:t.jsx(Xe,{size:24})})]})}function Fn(){const{messages:e,isNewMessage:n,setIsNewMessage:s,lastScrollHeight:r,setLastScrollHeight:o}=te(),{currentUser:a}=T(),d=i.useRef(null),c=l=>{const u=l.target;o(u.scrollTop)};return i.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[e]),i.useEffect(()=>{n&&s(!1),d.current&&(d.current.scrollTop=r)},[n,s,r]),t.jsx("div",{className:"flex-grow overflow-auto rounded-md bg-darkHover p-2",ref:d,onScroll:c,children:e.map((l,u)=>t.jsxs("div",{className:"mb-2 w-[80%] self-end break-words rounded-md bg-dark px-3 py-2"+(l.username===a.username?" ml-auto ":""),children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-xs text-primary",children:l.username}),t.jsx("span",{className:"text-xs text-white",children:l.timestamp})]}),t.jsx("p",{className:"py-1",children:l.message})]},u))})}function $(){const[e,n]=i.useState({width:window.innerWidth,height:window.innerHeight}),[s,r]=i.useState(window.innerWidth<768);return i.useEffect(()=>{const o=()=>{n({width:window.innerWidth,height:window.innerHeight}),r(window.innerWidth<768)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),{...e,isMobile:s}}function P(){const[e,n]=i.useState(!1),{height:s,isMobile:r}=$(),[o,a]=i.useState(s);return i.useEffect(()=>{s<500&&r?(n(!0),a(s)):r?(n(!1),a(s-50)):(n(!1),a(s))},[s,r,o]),{viewHeight:o,minHeightReached:e}}const An=()=>{const{viewHeight:e}=P();return t.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:e},children:[t.jsx("h1",{className:"view-title",children:"Group Chat"}),t.jsx(Fn,{}),t.jsx(On,{})]})},Pn="https://text.pollinations.ai",_n=Ee.create({baseURL:Pn,headers:{"Content-Type":"application/json"}}),Re=i.createContext(null),Un=()=>{const e=i.useContext(Re);if(e===null)throw new Error("useCopilot must be used within a CopilotContextProvider");return e},Mn=({children:e})=>{const[n,s]=i.useState(""),[r,o]=i.useState(""),[a,d]=i.useState(!1),c=async()=>{try{if(n.length===0){k.error("Please write a prompt");return}k.loading("Generating code..."),d(!0);const l=await _n.post("/",{messages:[{role:"system",content:"You are a code generator copilot for project named Code Sync. Generate code based on the given prompt without any explanation. Return only the code, formatted in Markdown using the appropriate language syntax (e.g., js for JavaScript, py for Python). Do not include any additional text or explanations. If you don't know the answer, respond with 'I don't know'."},{role:"user",content:n}],model:"mistral",private:!0});if(l.data){k.success("Code generated successfully");const u=l.data;u&&o(u)}d(!1),k.dismiss()}catch(l){console.error(l),d(!1),k.dismiss(),k.error("Failed to generate the code")}};return t.jsx(Re.Provider,{value:{setInput:s,output:r,isRunning:a,generateCode:c},children:e})},zn=`function sayHi() {
  console.log("ðŸ‘‹ Hello world");
}

sayHi()`,Hn={name:"root",id:U(),type:"directory",children:[{id:U(),type:"file",name:"index.js",content:zn}]},Le=(e,n)=>{if(e.id===n&&e.type==="directory")return e;if(e.type==="directory"&&e.children)for(const s of e.children){const r=Le(s,n);if(r)return r}return null},pe=(e,n)=>e.children?e.children.some(s=>s.name===n):!1,Gn=(e,n)=>{const s=r=>{if(r.id===n)return r;if(r.children)for(const o of r.children){const a=s(o);if(a)return a}return null};return s(e)},Te=e=>{if(e.type==="directory"&&e.children){let n=e.children.filter(r=>r.type==="directory");const s=e.children.filter(r=>r.type==="file");n.sort((r,o)=>r.name.localeCompare(o.name)),n=n.map(r=>Te(r)),s.sort((r,o)=>r.name.localeCompare(o.name)),e.children=[...n.filter(r=>r.name.startsWith(".")),...n.filter(r=>!r.name.startsWith(".")),...s.filter(r=>r.name.startsWith(".")),...s.filter(r=>!r.name.startsWith("."))]}return e},Oe=i.createContext(null),G=()=>{const e=i.useContext(Oe);if(!e)throw new Error("useFileSystem must be used within FileContextProvider");return e};function Yn({children:e}){const{socket:n}=M(),{setUsers:s,drawingData:r}=T(),[o,a]=i.useState(Hn),d=o.children?o.children:[],[c,l]=i.useState(d),[u,h]=i.useState(c[0]),g=x=>{const w=E=>E.id===x?{...E,isOpen:!E.isOpen}:E.children?{...E,children:E.children.map(w)}:E;a(E=>w(E))},f=()=>{const x=w=>{var E;return{...w,isOpen:!1,children:(E=w.children)==null?void 0:E.map(x)}};a(w=>x(w))},m=i.useCallback((x,w,E=!0)=>{let b;typeof w=="string"?b={id:U(),name:w,type:"directory",children:[],isOpen:!1}:b=w,x||(x=o.id);const v=j=>j.id===x?{...j,children:[...j.children||[],b]}:j.children?{...j,children:j.children.map(v)}:j;return a(j=>v(j)),E&&n.emit(C.DIRECTORY_CREATED,{parentDirId:x,newDirectory:b}),b.id},[o.id,n]),p=i.useCallback((x,w,E=!0)=>{x||(x=o.id);const b=v=>v.id===x?{...v,children:w}:v.children?{...v,children:v.children.map(b)}:v;a(v=>b(v)),l([]),h(null),x===o.id&&(R.dismiss(),R.success("Files and folders updated")),E&&n.emit(C.DIRECTORY_UPDATED,{dirId:x,children:w})},[o.id,n]),y=i.useCallback((x,w,E=!0)=>{const b=j=>j.type==="directory"&&j.children?j.children.some(D=>D.type==="directory"&&D.name===w&&D.id!==x)?null:{...j,children:j.children.map(D=>{if(D.id===x)return{...D,name:w};if(D.type==="directory"){const B=b(D);return B!==null?B:D}else return D})}:j,v=b(o);return v===null?!1:(a(v),E&&n.emit(C.DIRECTORY_RENAMED,{dirId:x,newDirName:w}),!0)},[n,a,o]),S=i.useCallback((x,w=!0)=>{const E=b=>{if(b.type==="directory"&&b.id===x)return null;if(b.children){const v=b.children.map(E).filter(j=>j!==null);return{...b,children:v}}else return b};a(b=>E(b)),w&&n.emit(C.DIRECTORY_DELETED,{dirId:x})},[n]),N=x=>{const w=Gn(o,x);w&&(A((u==null?void 0:u.id)||"",(u==null?void 0:u.content)||""),c.some(E=>E.id===x)||l(E=>[...E,w]),l(E=>E.map(b=>b.id===(u==null?void 0:u.id)?{...b,content:u.content||""}:b)),h(w))},_=x=>{if(x===(u==null?void 0:u.id)){A(u.id,u.content||"");const w=c.findIndex(E=>E.id===x);w!==-1&&c.length>1?w>0?h(c[w-1]):h(c[w+1]):h(null)}l(w=>w.filter(E=>E.id!==x))},O=i.useCallback((x,w,E=!0)=>{let b=1;x||(x=o.id);const v=Le(o,x);if(!v)throw new Error("Parent directory not found");let j;if(typeof w=="string"){let D=w,B=pe(v,D);for(;B;)D=`${D.split(".")[0]}(${b}).${D.split(".")[1]}`,B=pe(v,D),b++;j={id:U(),name:D,type:"file",content:""}}else j=w;const K=D=>D.id===v.id?{...D,children:[...D.children||[],j],isOpen:!0}:D.children?{...D,children:D.children.map(K)}:D;return a(D=>K(D)),l(D=>[...D,j]),h(j),E&&n.emit(C.FILE_CREATED,{parentDirId:x,newFile:j}),j.id},[o,n]),A=i.useCallback((x,w)=>{const E=b=>b.type==="file"&&b.id===x?{...b,content:w}:b.children?{...b,children:b.children.map(E)}:b;a(b=>E(b)),c.some(b=>b.id===x)&&l(b=>b.map(v=>v.id===x?{...v,content:w}:v))},[c]),L=i.useCallback((x,w,E=!0)=>{const b=v=>v.type==="directory"&&v.children?{...v,children:v.children.map(j=>j.type==="file"&&j.id===x?{...j,name:w}:j)}:v;return a(v=>b(v)),l(v=>v.map(j=>j.id===x?{...j,name:w}:j)),x===(u==null?void 0:u.id)&&h(v=>v?{...v,name:w}:null),E&&n.emit(C.FILE_RENAMED,{fileId:x,newName:w}),!0},[u==null?void 0:u.id,n]),Y=i.useCallback((x,w=!0)=>{const E=b=>{if(b.type==="directory"&&b.children){const v=b.children.map(j=>j.type==="directory"?E(j):j.id!==x?j:null).filter(j=>j!==null);return{...b,children:v}}else return b};a(b=>E(b)),c.some(b=>b.id===x)&&l(b=>b.filter(v=>v.id!==x)),(u==null?void 0:u.id)===x&&h(null),R.success("File deleted successfully"),w&&n.emit(C.FILE_DELETED,{fileId:x})},[u==null?void 0:u.id,c,n]),We=()=>{const x=new gt,w=(E,b="")=>{const v=b+E.name+(E.type==="directory"?"/":"");if(E.type==="file")x.file(v,E.content||"");else if(E.type==="directory"&&E.children)for(const j of E.children)w(j,v)};if(o.type==="directory"&&o.children)for(const E of o.children)w(E);x.generateAsync({type:"blob"}).then(E=>{xt.saveAs(E,"download.zip")})},ne=i.useCallback(({user:x})=>{R.success(`${x.username} joined the room`),n.emit(C.SYNC_FILE_STRUCTURE,{fileStructure:o,openFiles:c,activeFile:u,socketId:x.socketId}),n.emit(C.SYNC_DRAWING,{drawingData:r,socketId:x.socketId}),s(w=>[...w,x])},[u,r,o,c,s,n]),se=i.useCallback(({fileStructure:x,openFiles:w,activeFile:E})=>{a(x),l(w),h(E),R.dismiss()},[]),re=i.useCallback(({parentDirId:x,newDirectory:w})=>{m(x,w,!1)},[m]),oe=i.useCallback(({dirId:x,children:w})=>{p(x,w,!1)},[p]),ie=i.useCallback(({dirId:x,newName:w})=>{y(x,w,!1)},[y]),ae=i.useCallback(({dirId:x})=>{S(x,!1)},[S]),le=i.useCallback(({parentDirId:x,newFile:w})=>{O(x,w,!1)},[O]),ce=i.useCallback(({fileId:x,newContent:w})=>{A(x,w),(u==null?void 0:u.id)===x&&h({...u,content:w})},[u,A]),ue=i.useCallback(({fileId:x,newName:w})=>{L(x,w,!1)},[L]),de=i.useCallback(({fileId:x})=>{Y(x,!1)},[Y]);return i.useEffect(()=>(n.once(C.SYNC_FILE_STRUCTURE,se),n.on(C.USER_JOINED,ne),n.on(C.DIRECTORY_CREATED,re),n.on(C.DIRECTORY_UPDATED,oe),n.on(C.DIRECTORY_RENAMED,ie),n.on(C.DIRECTORY_DELETED,ae),n.on(C.FILE_CREATED,le),n.on(C.FILE_UPDATED,ce),n.on(C.FILE_RENAMED,ue),n.on(C.FILE_DELETED,de),()=>{n.off(C.USER_JOINED),n.off(C.DIRECTORY_CREATED),n.off(C.DIRECTORY_UPDATED),n.off(C.DIRECTORY_RENAMED),n.off(C.DIRECTORY_DELETED),n.off(C.FILE_CREATED),n.off(C.FILE_UPDATED),n.off(C.FILE_RENAMED),n.off(C.FILE_DELETED)}),[re,ae,ie,oe,le,de,ue,se,ce,ne,n]),t.jsx(Oe.Provider,{value:{fileStructure:o,openFiles:c,activeFile:u,setActiveFile:h,closeFile:_,toggleDirectory:g,collapseDirectories:f,createDirectory:m,updateDirectory:p,renameDirectory:y,deleteDirectory:S,openFile:N,createFile:O,updateFileContent:A,renameFile:L,deleteFile:Y,downloadFilesAndFolders:We},children:e})}function Wn(){const{socket:e}=M(),{viewHeight:n}=P(),{generateCode:s,output:r,isRunning:o,setInput:a}=Un(),{activeFile:d,updateFileContent:c,setActiveFile:l}=G(),u=async()=>{try{const f=r.replace(/```[\w]*\n?/g,"").trim();await navigator.clipboard.writeText(f),k.success("Output copied to clipboard")}catch(f){k.error("Unable to copy output to clipboard"),console.log(f)}},h=()=>{if(d){const m=`${d.content?`${d.content}
`:""}${r.replace(/```[\w]*\n?/g,"").trim()}`;c(d.id,m),l({...d,content:m}),k.success("Code pasted successfully"),e.emit(C.FILE_UPDATED,{fileId:d.id,newContent:m})}},g=()=>{if(d){if(!confirm("Are you sure you want to replace the code in the file?"))return;const m=r.replace(/```[\w]*\n?/g,"").trim();c(d.id,m),l({...d,content:m}),k.success("Code replaced successfully"),e.emit(C.FILE_UPDATED,{fileId:d.id,newContent:m})}};return t.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:n},children:[t.jsx("h1",{className:"view-title",children:"Copilot"}),t.jsx("textarea",{className:"min-h-[120px] w-full rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"What code do you want to generate?",onChange:f=>a(f.target.value)}),t.jsx("button",{className:"mt-1 flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:s,disabled:o,children:o?"Generating...":"Generate Code"}),r&&t.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[t.jsx("button",{title:"Copy Output",onClick:u,children:t.jsx(ee,{size:18,className:"cursor-pointer text-white"})}),t.jsx("button",{title:"Replace code in file",onClick:g,children:t.jsx(qe,{size:18,className:"cursor-pointer text-white"})}),t.jsx("button",{title:"Paste code in file",onClick:h,children:t.jsx(Qe,{size:18,className:"cursor-pointer text-white"})})]}),t.jsx("div",{className:"h-full rounded-lg w-full overflow-y-auto p-0",children:t.jsx(wt,{components:{code({inline:f,className:m,children:p,...y}){const S=/language-(\w+)/.exec(m||""),N=S?S[1]:"javascript";return f?t.jsx("code",{className:m,...y,children:p}):t.jsx(Ct,{style:bt,language:N,PreTag:"pre",className:"!m-0 !h-full !rounded-lg !bg-gray-900 !p-2",children:String(p).replace(/\n$/,"")})},pre({children:f}){return t.jsx("pre",{className:"h-full",children:f})}},children:r})})]})}const Fe=({ref:e})=>{const[n,s]=i.useState(!1),[r,o]=i.useState({x:0,y:0});return i.useEffect(()=>{const a=e.current;if(!a)return;const d=()=>{s(!1)},c=u=>{e.current&&e.current.contains(u.target)?(s(!0),o({x:u.pageX,y:u.pageY})):s(!1)},l=u=>{u.preventDefault(),s(!0),o({x:u.pageX,y:u.pageY})};return a.addEventListener("contextmenu",l),document.addEventListener("click",d),document.addEventListener("contextmenu",c),()=>{a.removeEventListener("contextmenu",l),document.removeEventListener("click",d),document.removeEventListener("contextmenu",c)}},[e]),{menuOpen:n,setMenuOpen:s,coords:r,setCoords:o}},Ae=e=>{var r;return`vscode-icons:${(r=yt.getIconForFile(e))==null?void 0:r.replace(/_/g,"-").split(".")[0]}`};function Pe({id:e,preName:n,setEditing:s,type:r}){const[o,a]=i.useState(n||""),{renameFile:d,openFile:c,renameDirectory:l}=G(),u=i.useRef(null),h=m=>{m.preventDefault(),m.stopPropagation();const p=r.charAt(0).toUpperCase()+r.slice(1);if(o==="")k.error(`${p} name cannot be empty`);else if(o.length>25)k.error(`${p} name cannot be longer than 25 characters`);else if(o===n)k.error(`${p} name cannot be the same as before`);else{const y=r==="directory"?l(e,o):d(e,o);y&&r==="file"&&c(e),y?s(!1):k.error(`${p} with same name already exists`)}},g=i.useCallback(m=>{var p;m.key==="Enter"?(p=u.current)==null||p.requestSubmit():m.key==="Escape"&&s(!1)},[s]),f=i.useCallback(m=>{const p=u.current;p&&!p.contains(m.target)&&s(!1)},[s]);return i.useEffect(()=>{const m=u.current;if(m)return m.focus(),m.addEventListener("keydown",g),document.addEventListener("keydown",f),document.addEventListener("click",f),()=>{m.removeEventListener("keydown",g),document.removeEventListener("keydown",f),document.removeEventListener("click",f)}},[f,g,s]),t.jsx("div",{className:"rounded-md",children:t.jsx("form",{onSubmit:h,ref:u,className:"flex w-full items-center gap-2 rounded-md",children:t.jsx("input",{type:"text",className:"w-full flex-grow rounded-sm bg-dark px-2 text-base text-white outline-none",autoFocus:!0,value:o,onChange:m=>a(m.target.value)})})})}function Jn(){const{fileStructure:e,createFile:n,createDirectory:s,collapseDirectories:r}=G(),o=i.useRef(null),[a,d]=i.useState(null),{minHeightReached:c}=P(),l=f=>{o.current&&!o.current.contains(f.target)&&d(e.id)},u=()=>{const f=prompt("Enter file name");if(f){const m=a||e.id;n(m,f)}},h=()=>{const f=prompt("Enter directory name");if(f){const m=a||e.id;s(m,f)}},g=Te(e);return t.jsxs("div",{onClick:l,className:"flex flex-grow flex-col",children:[t.jsxs("div",{className:"view-title flex justify-between",children:[t.jsx("h2",{children:"Files"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:u,title:"Create File",children:t.jsx(Ke,{size:20})}),t.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:h,title:"Create Directory",children:t.jsx(Ze,{size:20})}),t.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:r,title:"Collapse All Directories",children:t.jsx(et,{size:20})})]})]}),t.jsx("div",{className:J("min-h-[200px] flex-grow overflow-auto pr-2 sm:min-h-0",{"h-[calc(80vh-170px)]":!c,"h-[85vh]":c}),ref:o,children:g.children&&g.children.map(f=>t.jsx(_e,{item:f,setSelectedDirId:d},f.id))})]})}function _e({item:e,setSelectedDirId:n}){const[s,r]=i.useState(!1),o=i.useRef(null),{coords:a,menuOpen:d,setMenuOpen:c}=Fe({ref:o}),{deleteDirectory:l,toggleDirectory:u}=G(),h=m=>{n(m),u(m)},g=m=>{m.stopPropagation(),c(!1),r(!0)},f=(m,p)=>{m.stopPropagation(),c(!1),confirm("Are you sure you want to delete directory?")&&l(p)};return i.useEffect(()=>{const m=o.current;if(!m)return;m.tabIndex=0;const p=y=>{y.stopPropagation(),y.key==="F2"&&r(!0)};return m.addEventListener("keydown",p),()=>{m.removeEventListener("keydown",p)}},[]),e.type==="file"?t.jsx($n,{item:e,setSelectedDirId:n}):t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>h(e.id),ref:o,children:[e.isOpen?t.jsx(tt,{size:24,className:"mr-2 min-w-fit"}):t.jsx(nt,{size:24,className:"mr-2 min-w-fit"}),s?t.jsx(Pe,{id:e.id,preName:e.name,type:"directory",setEditing:r}):t.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:e.name,children:e.name})]}),t.jsx("div",{className:J({hidden:!e.isOpen},{block:e.isOpen},{"pl-4":e.name!=="root"}),children:e.children&&e.children.map(m=>t.jsx(_e,{item:m,setSelectedDirId:n},m.id))}),d&&t.jsx(Vn,{handleDeleteDirectory:f,handleRenameDirectory:g,id:e.id,left:a.x,top:a.y})]})}const $n=({item:e,setSelectedDirId:n})=>{const{deleteFile:s,openFile:r}=G(),[o,a]=i.useState(!1),{setIsSidebarOpen:d}=Q(),{isMobile:c}=$(),{activityState:l,setActivityState:u}=T(),h=i.useRef(null),{menuOpen:g,coords:f,setMenuOpen:m}=Fe({ref:h}),p=N=>{o||(n(N),r(N),c&&d(!1),l===H.DRAWING&&u(H.CODING))},y=N=>{N.stopPropagation(),a(!0),m(!1)},S=(N,_)=>{N.stopPropagation(),m(!1),confirm("Are you sure you want to delete file?")&&s(_)};return i.useEffect(()=>{const N=h.current;if(!N)return;N.tabIndex=0;const _=O=>{O.stopPropagation(),O.key==="F2"&&a(!0)};return N.addEventListener("keydown",_),()=>{N.removeEventListener("keydown",_)}},[]),t.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>p(e.id),ref:h,children:[t.jsx(Ne,{icon:Ae(e.name),fontSize:22,className:"mr-2 min-w-fit"}),o?t.jsx(Pe,{id:e.id,preName:e.name,type:"file",setEditing:a}):t.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:e.name,children:e.name}),g&&t.jsx(Bn,{top:f.y,left:f.x,id:e.id,handleRenameFile:y,handleDeleteFile:S})]})},Bn=({top:e,left:n,id:s,handleRenameFile:r,handleDeleteFile:o})=>t.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:e,left:n},children:[t.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[t.jsx(Ce,{size:18}),"Rename"]}),t.jsxs("button",{onClick:a=>o(a,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[t.jsx(be,{size:20}),"Delete"]})]}),Vn=({top:e,left:n,id:s,handleRenameDirectory:r,handleDeleteDirectory:o})=>t.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:e,left:n},children:[t.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[t.jsx(Ce,{size:18}),"Rename"]}),t.jsxs("button",{onClick:a=>o(a,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[t.jsx(be,{size:20}),"Delete"]})]});function Xn(){const{downloadFilesAndFolders:e,updateDirectory:n}=G(),{viewHeight:s}=P(),{minHeightReached:r}=P(),[o,a]=i.useState(!1),d=async()=>{try{if(a(!0),"showDirectoryPicker"in window){const g=await window.showDirectoryPicker();await c(g);return}if("webkitdirectory"in HTMLInputElement.prototype){const g=document.createElement("input");g.type="file",g.webkitdirectory=!0,g.onchange=async f=>{const m=f.target.files;if(m){const p=await u(m);n("",p)}},g.click();return}R.error("Your browser does not support directory selection.")}catch(g){console.error("Error opening directory:",g),R.error("Failed to open directory")}finally{a(!1)}},c=async g=>{try{R.loading("Getting files and folders...");const f=await l(g);n("",f),R.dismiss(),R.success("Directory loaded successfully")}catch(f){console.error("Error processing directory:",f),R.error("Failed to process directory")}},l=async g=>{const f=[],m=["node_modules",".git",".vscode",".next"];for await(const p of g.values())if(p.kind==="file"){const y=await p.getFile(),S={id:U(),name:p.name,type:"file",content:await h(y)};f.push(S)}else if(p.kind==="directory"){if(m.includes(p.name))continue;const y={id:U(),name:p.name,type:"directory",children:await l(p),isOpen:!1};f.push(y)}return f},u=async g=>{const f=[],m=["node_modules",".git",".vscode",".next"];for(let p=0;p<g.length;p++){const y=g[p],S=y.webkitRelativePath.split("/");if(!S.some(N=>m.includes(N)))if(S.length>1){const N=S.slice(0,-1).join("/");if(f.findIndex(L=>L.name===N&&L.type==="directory")===-1){const L={id:U(),name:N,type:"directory",children:[],isOpen:!1};f.push(L)}const O={id:U(),name:y.name,type:"file",content:await h(y)},A=f.find(L=>L.name===N&&L.type==="directory");A&&A.children&&A.children.push(O)}else{const N={id:U(),name:y.name,type:"file",content:await h(y)};f.push(N)}}return f},h=async g=>{if(g.size>1048576)return`File too large: ${g.name} (${Math.round(g.size/1024)}KB)`;try{return await g.text()}catch(m){return console.error(`Error reading file ${g.name}:`,m),`Error reading file: ${g.name}`}};return t.jsxs("div",{className:"flex select-none flex-col gap-1 px-4 py-2",style:{height:s,maxHeight:s},children:[t.jsx(Jn,{}),t.jsxs("div",{className:J("flex min-h-fit flex-col justify-end pt-2",{hidden:r}),children:[t.jsx("hr",{}),t.jsxs("button",{className:"mt-2 flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:d,disabled:o,children:[t.jsx(st,{className:"mr-2",size:24}),o?"Loading...":"Open File/Folder"]}),t.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:e,children:[t.jsx(rt,{className:"mr-2",size:22})," Download Code"]})]})]})}const qn="https://emkc.org/api/v2/piston",he=Ee.create({baseURL:qn,headers:{"Content-Type":"application/json"}}),Ue=i.createContext(null),Qn=()=>{const e=i.useContext(Ue);if(e===null)throw new Error("useRunCode must be used within a RunCodeContextProvider");return e},Kn=({children:e})=>{const{activeFile:n}=G(),[s,r]=i.useState(""),[o,a]=i.useState(""),[d,c]=i.useState(!1),[l,u]=i.useState([]),[h,g]=i.useState({language:"",version:"",aliases:[]});i.useEffect(()=>{(async()=>{var p,y;try{const S=await he.get("/runtimes");u(S.data)}catch(S){k.error("Failed to fetch supported languages"),(p=S==null?void 0:S.response)!=null&&p.data&&console.error((y=S==null?void 0:S.response)==null?void 0:y.data)}})()},[]),i.useEffect(()=>{if(l.length===0||!(n!=null&&n.name))return;const m=n.name.split(".").pop();if(m){const p=ve.languages(m),y=l.find(S=>S.aliases.includes(m)||p.includes(S.language.toLowerCase()));y&&g(y)}else g({language:"",version:"",aliases:[]})},[n==null?void 0:n.name,l]);const f=async()=>{try{if(h)if(n)k.loading("Running code...");else return k.error("Please open a file to run the code");else return k.error("Please select a language to run the code");c(!0);const{language:m,version:p}=h,y=await he.post("/execute",{language:m,version:p,files:[{name:n.name,content:n.content}],stdin:s});y.data.run.stderr?a(y.data.run.stderr):a(y.data.run.stdout),c(!1),k.dismiss()}catch(m){console.error(m.response.data),console.error(m.response.data.error),c(!1),k.dismiss(),k.error("Failed to run the code")}};return t.jsx(Ue.Provider,{value:{setInput:r,output:o,isRunning:d,supportedLanguages:l,selectedLanguage:h,setSelectedLanguage:g,runCode:f},children:e})};function Zn(){const{viewHeight:e}=P(),{setInput:n,output:s,isRunning:r,supportedLanguages:o,selectedLanguage:a,setSelectedLanguage:d,runCode:c}=Qn(),l=h=>{const g=JSON.parse(h.target.value);d(g)},u=()=>{navigator.clipboard.writeText(s),k.success("Output copied to clipboard")};return t.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:e},children:[t.jsx("h1",{className:"view-title",children:"Run Code"}),t.jsxs("div",{className:"flex h-[90%] w-full flex-col items-end gap-2 md:h-[92%]",children:[t.jsxs("div",{className:"relative w-full",children:[t.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:JSON.stringify(a),onChange:l,children:o.sort((h,g)=>h.language>g.language?1:-1).map((h,g)=>t.jsx("option",{value:JSON.stringify(h),children:h.language+(h.version?` (${h.version})`:"")},g))}),t.jsx(ye,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]}),t.jsx("textarea",{className:"min-h-[120px] w-full resize-none rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"Write you input here...",onChange:h=>n(h.target.value)}),t.jsx("button",{className:"flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:c,disabled:r,children:"Run"}),t.jsxs("label",{className:"flex w-full justify-between",children:["Output :",t.jsx("button",{onClick:u,title:"Copy Output",children:t.jsx(ee,{size:18,className:"cursor-pointer text-white"})})]}),t.jsx("div",{className:"w-full flex-grow resize-none overflow-y-auto rounded-md border-none bg-darkHover p-2 text-white outline-none",children:t.jsx("code",{children:t.jsx("pre",{className:"text-wrap",children:s})})})]})]})}function Z({onChange:e,value:n,options:s,title:r}){return t.jsxs("div",{className:"relative w-full",children:[t.jsx("label",{className:"mb-2",children:r}),t.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:n,onChange:e,children:s.sort().map(o=>{const a=o,d=o.charAt(0).toUpperCase()+o.slice(1);return t.jsx("option",{value:a,children:d},d)})}),t.jsx(ye,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]})}function Me(){return{setItem:(r,o)=>{localStorage.setItem(r,o)},getItem:r=>localStorage.getItem(r),removeItem:r=>{localStorage.removeItem(r)}}}const ze=i.createContext(null),q=()=>{const e=i.useContext(ze);if(!e)throw new Error("useSettings must be used within a SettingContextProvider");return e},z={theme:"Dracula",language:"Javascript",fontSize:16,fontFamily:"Space Mono",showGitHubCorner:!0};function es({children:e}){const{getItem:n}=Me(),s=JSON.parse(n("settings")||"{}"),r=s.theme!==void 0?s.theme:z.theme,o=s.language!==void 0?s.language:z.language,a=s.fontSize!==void 0?s.fontSize:z.fontSize,d=s.fontFamily!==void 0?s.fontFamily:z.fontFamily,c=s.showGitHubCorner!==void 0?s.showGitHubCorner:z.showGitHubCorner,[l,u]=i.useState(r),[h,g]=i.useState(o),[f,m]=i.useState(a),[p,y]=i.useState(d),[S,N]=i.useState(c),_=()=>{u(z.theme),g(z.language),m(z.fontSize),y(z.fontFamily),N(z.showGitHubCorner)};return i.useEffect(()=>{const O={theme:l,language:h,fontSize:f,fontFamily:p,showGitHubCorner:S};localStorage.setItem("settings",JSON.stringify(O))},[l,h,f,p,S]),t.jsx(ze.Provider,{value:{theme:l,setTheme:u,language:h,setLanguage:g,fontSize:f,setFontSize:m,fontFamily:p,setFontFamily:y,showGitHubCorner:S,setShowGitHubCorner:N,resetSettings:_},children:e})}const ts=["Anonymous Pro","Cousine","Fira Code","Inconsolata","JetBrains Mono","Jura","Roboto Mono","Source Code Pro","Space Mono","Ubuntu Mono"],He={Abcdef:dn,Abyss:un,"Android Studio":cn,Andromeda:ln,"Atom One":an,Aura:on,"Basic Dark":rn,"Basic Light":sn,BBEdit:nn,Bespin:tn,Copilot:en,Darcula:Zt,Dracula:Kt,"Duotone Dark":Qt,"Duotone Light":qt,Eclipse:Xt,"GitHub Dark":Vt,"GitHub Light":Bt,"Gruvbox Dark":$t,"Gruvbox Light":Jt,Kimbie:Wt,Material:Yt,"Material Dark":Gt,"Material Light":Ht,Monokai:zt,"Monokai Dimmed":Mt,"Noctis Lilac":Ut,Nord:_t,Okaidia:Pt,"Quiet Light":At,Red:Ft,"Solarized Dark":Ot,"Solarized Light":Tt,Sublime:Lt,"Tokyo Night":Rt,"Tokyo Night Day":kt,"Tokyo Night Storm":It,"Tomorrow Night Blue":Dt,"VS Code Dark":St,"White Dark":jt,"White Light":vt,"Xcode Dark":Nt,"Xcode Light":Et};function ns(){const{theme:e,setTheme:n,language:s,setLanguage:r,fontSize:o,setFontSize:a,fontFamily:d,setFontFamily:c,showGitHubCorner:l,setShowGitHubCorner:u,resetSettings:h}=q(),{viewHeight:g}=P(),f=N=>c(N.target.value),m=N=>n(N.target.value),p=N=>r(N.target.value),y=N=>a(parseInt(N.target.value)),S=N=>u(N.target.checked);return i.useEffect(()=>{const N=document.querySelector(".cm-editor > .cm-scroller");N!==null&&(N.style.fontFamily=`${d}, monospace`)},[d]),t.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:g},children:[t.jsx("h1",{className:"view-title",children:"Settings"}),t.jsxs("div",{className:"flex w-full items-end gap-2",children:[t.jsx(Z,{onChange:f,value:d,options:ts,title:"Font Family"}),t.jsx("select",{value:o,onChange:y,className:"rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",title:"Font Size",children:[...Array(13).keys()].map(N=>t.jsx("option",{value:N+12,children:N+12},N))})]}),t.jsx(Z,{onChange:m,value:e,options:Object.keys(He),title:"Theme"}),t.jsx(Z,{onChange:p,value:s,options:mn,title:"Language"}),t.jsxs("div",{className:"mt-4 flex w-full items-center justify-between",children:[t.jsx("label",{children:"Show github corner"}),t.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[t.jsx("input",{className:"peer sr-only",type:"checkbox",onChange:S,checked:l}),t.jsx("div",{className:"peer h-6 w-12 rounded-full bg-darkHover outline-none duration-100 after:absolute after:left-1 after:top-1 after:flex after:h-4 after:w-4 after:items-center after:justify-center after:rounded-full after:bg-white after:font-bold after:outline-none after:duration-500 peer-checked:after:translate-x-6 peer-checked:after:border-white peer-focus:outline-none"})]})]}),t.jsx("button",{className:"mt-auto w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",onClick:h,children:"Reset to default"})]})}function ss(){const{users:e}=T();return t.jsx("div",{className:"flex min-h-[200px] flex-grow justify-center overflow-y-auto py-2",children:t.jsx("div",{className:"flex h-full w-full flex-wrap items-start gap-x-2 gap-y-6",children:e.map(n=>t.jsx(rs,{user:n},n.socketId))})})}const rs=({user:e})=>{const{username:n,status:s}=e,r=`${n} - ${s===V.ONLINE?"online":"offline"}`;return t.jsxs("div",{className:"relative flex w-[100px] flex-col items-center gap-2",title:r,children:[t.jsx(gn,{name:n,size:"50",round:"12px",title:r}),t.jsx("p",{className:"line-clamp-2 max-w-full text-ellipsis break-words",children:n}),t.jsx("div",{className:`absolute right-5 top-0 h-3 w-3 rounded-full ${s===V.ONLINE?"bg-green-500":"bg-danger"}`})]})};function os(){const e=X(),{viewHeight:n}=P(),{setStatus:s}=T(),{socket:r}=M(),o=async()=>{const c=window.location.href;try{await navigator.clipboard.writeText(c),k.success("URL copied to clipboard")}catch(l){k.error("Unable to copy URL to clipboard"),console.log(l)}},a=async()=>{const c=window.location.href;try{await navigator.share({url:c})}catch(l){k.error("Unable to share URL"),console.log(l)}},d=()=>{r.disconnect(),s(F.DISCONNECTED),e("/",{replace:!0})};return t.jsxs("div",{className:"flex flex-col p-4",style:{height:n},children:[t.jsx("h1",{className:"view-title",children:"Users"}),t.jsx(ss,{}),t.jsx("div",{className:"flex flex-col items-center gap-4 pt-4",children:t.jsxs("div",{className:"flex w-full gap-4",children:[t.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:a,title:"Share Link",children:t.jsx(ot,{size:26})}),t.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:o,title:"Copy Link",children:t.jsx(ee,{size:22})}),t.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-primary p-3 text-black",onClick:d,title:"Leave room",children:t.jsx(it,{size:22})})]})})]})}var I=(e=>(e.FILES="FILES",e.CHATS="CHATS",e.CLIENTS="CLIENTS",e.RUN="RUN",e.COPILOT="COPILOT",e.SETTINGS="SETTINGS",e))(I||{});const Ge=i.createContext(null),Q=()=>{const e=i.useContext(Ge);if(!e)throw new Error("useViews must be used within a ViewContextProvider");return e};function is({children:e}){const{isMobile:n}=$(),[s,r]=i.useState(I.FILES),[o,a]=i.useState(!n),[d]=i.useState({[I.FILES]:t.jsx(Xn,{}),[I.CLIENTS]:t.jsx(os,{}),[I.SETTINGS]:t.jsx(ns,{}),[I.COPILOT]:t.jsx(Wn,{}),[I.CHATS]:t.jsx(An,{}),[I.RUN]:t.jsx(Zn,{})}),[c]=i.useState({[I.FILES]:t.jsx(mt,{size:28}),[I.CLIENTS]:t.jsx(dt,{size:30}),[I.SETTINGS]:t.jsx(ut,{size:28}),[I.CHATS]:t.jsx(ct,{size:30}),[I.COPILOT]:t.jsx(lt,{size:28}),[I.RUN]:t.jsx(at,{size:28})});return t.jsx(Ge.Provider,{value:{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:a,viewComponents:d,viewIcons:c},children:e})}function as({children:e}){const{isSidebarOpen:n}=Q(),{isMobile:s,width:r}=$(),{setItem:o,getItem:a}=Me(),d=()=>{const f=document.createElement("div");return f.className="h-full cursor-e-resizer hidden md:block",f.style.backgroundColor="#e1e1ffb3",f},c=()=>{if(s)return[0,r];const f=a("editorSizes");let m=[35,65];return f&&(m=JSON.parse(f)),n?m:[0,r]},l=()=>s?[0,r]:n?[350,350]:[50,0],u=()=>s?[0,1/0]:n?[1/0,1/0]:[0,1/0],h=f=>{o("editorSizes",JSON.stringify(f))},g=()=>({width:"7px",display:n&&!s?"block":"none"});return t.jsx(bn,{sizes:c(),minSize:l(),gutter:d,maxSize:u(),dragInterval:1,direction:"horizontal",gutterAlign:"center",cursor:"e-resize",snapOffset:30,gutterStyle:g,onDrag:h,className:"flex h-screen min-h-screen max-w-full items-center justify-center overflow-hidden",children:e})}function ls(){return t.jsx("div",{className:"flex h-screen min-h-screen flex-col items-center justify-center gap-6 px-4 text-center",children:t.jsx(cs,{})})}const cs=()=>{const e=X(),n=()=>{window.location.reload()},s=()=>{e("/")};return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"whitespace-break-spaces text-lg font-medium text-slate-300",children:"Oops! Something went wrong. Please try again"}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[t.jsx("button",{className:"mr-4 rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:n,children:"Try Again"}),t.jsx("button",{className:"rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:s,children:"Go to HomePage"})]})]})},Ye={backgroundColor:"#e0e0e0",padding:"8px 12px",borderRadius:"6px",color:"#000",fontSize:"12px",fontWeight:"500",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},xe={base:"relative flex items-center justify-center rounded transition-colors duration-200 ease-in-out p-2",hover:"hover:bg-[#3D404A]"},W=({viewName:e,icon:n})=>{const{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:a}=Q(),{isNewMessage:d}=te(),[c,l]=i.useState(!0),u=h=>{h===s?a(!o):(a(!0),r(h))};return t.jsxs("div",{className:"relative flex flex-col items-center",children:[t.jsxs("button",{onClick:()=>u(e),onMouseEnter:()=>l(!0),className:`${xe.base} ${xe.hover}`,...c&&{"data-tooltip-id":`tooltip-${e}`,"data-tooltip-content":e},children:[t.jsx("div",{className:"flex items-center justify-center",children:n}),e===I.CHATS&&d&&t.jsx("div",{className:"absolute right-0 top-0 h-3 w-3 rounded-full bg-primary"})]}),c&&t.jsx(Se,{id:`tooltip-${e}`,place:"right",offset:25,className:"!z-50",style:Ye,noArrow:!1,positionStrategy:"fixed",float:!0})]})};function us(){const{activeView:e,isSidebarOpen:n,viewComponents:s,viewIcons:r,setIsSidebarOpen:o}=Q(),{minHeightReached:a}=P(),{activityState:d,setActivityState:c}=T(),{socket:l}=M(),{isMobile:u}=$(),[h,g]=i.useState(!0),f=()=>{g(!1),d===H.CODING?(c(H.DRAWING),l.emit(C.REQUEST_DRAWING)):c(H.CODING),u&&o(!1)};return t.jsxs("aside",{className:"flex w-full md:h-full md:max-h-full md:min-h-full md:w-auto",children:[t.jsxs("div",{className:J("fixed bottom-0 left-0 z-50 flex h-[50px] w-full gap-4 self-end overflow-hidden border-t border-darkHover bg-dark p-2 md:static md:h-full md:w-[50px] md:min-w-[50px] md:flex-col md:border-r md:border-t-0 md:p-2 md:pt-4",{hidden:a}),children:[t.jsx(W,{viewName:I.FILES,icon:r[I.FILES]}),t.jsx(W,{viewName:I.CHATS,icon:r[I.CHATS]}),t.jsx(W,{viewName:I.COPILOT,icon:r[I.COPILOT]}),t.jsx(W,{viewName:I.RUN,icon:r[I.RUN]}),t.jsx(W,{viewName:I.CLIENTS,icon:r[I.CLIENTS]}),t.jsx(W,{viewName:I.SETTINGS,icon:r[I.SETTINGS]}),t.jsxs("div",{className:"flex h-fit items-center justify-center",children:[t.jsx("button",{className:"justify-cente flex items-center  rounded p-1.5 transition-colors duration-200 ease-in-out hover:bg-[#3D404A]",onClick:f,onMouseEnter:()=>g(!0),"data-tooltip-id":"activity-state-tooltip","data-tooltip-content":d===H.CODING?"Switch to Drawing Mode":"Switch to Coding Mode",children:d===H.CODING?t.jsx(ft,{size:30}):t.jsx(pt,{size:30})}),h&&t.jsx(Se,{id:"activity-state-tooltip",place:"right",offset:15,className:"!z-50",style:Ye,noArrow:!1,positionStrategy:"fixed",float:!0})]})]}),t.jsx("div",{className:"absolute left-0 top-0 z-20 w-full flex-col bg-dark md:static md:min-w-[300px]",style:n?{}:{display:"none"},children:s[e]})]})}function ds(){const{isMobile:e}=$();return t.jsx(yn,{inferDarkMode:!0,forceMobile:e,defaultName:"Editor",className:"z-0",children:t.jsx(ms,{})})}function ms(){const e=En(),{drawingData:n,setDrawingData:s}=T(),{socket:r}=M(),o=i.useCallback(d=>{const c=d.changes;s(e.store.getSnapshot()),r.emit(C.DRAWING_UPDATE,{snapshot:c})},[e.store,s,r]),a=i.useCallback(({snapshot:d})=>{e.store.mergeRemoteChanges(()=>{const{added:c,updated:l,removed:u}=d;for(const h of Object.values(c))e.store.put([h]);for(const[,h]of Object.values(l))e.store.put([h]);for(const h of Object.values(u))e.store.remove([h.id])}),s(e.store.getSnapshot())},[e.store,s]);return i.useEffect(()=>{n&&Object.keys(n).length>0&&e.store.loadSnapshot(n)},[]),i.useEffect(()=>{const d=e.store.listen(o,{source:"user",scope:"document"});return r.on(C.DRAWING_UPDATE,a),()=>{d(),r.off(C.DRAWING_UPDATE)}},[n,e.store,o,a,r]),null}function fs(){const{fontSize:e,setFontSize:n}=q();i.useEffect(()=>{const s=r=>{const o="Changes you made may not be saved";return r.returnValue=o};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]),i.useEffect(()=>{const s=r=>{if(r.ctrlKey){if(r.preventDefault(),!r.target.closest(".cm-editor"))return;r.deltaY>0?n(Math.max(e-1,12)):n(Math.min(e+1,24))}};return window.addEventListener("wheel",s,{passive:!1}),()=>{window.removeEventListener("wheel",s)}},[e,n])}function ps(e){return vn.define({create:()=>ge(e),update(n,s){return!s.docChanged&&!s.selection?n:ge(e)},provide:n=>jn.computeN([n],s=>s.field(n))})}function ge(e){return e.map(n=>{if(!n.typing)return null;let s=n.username;const r=n.cursorPosition;return n&&(s=n.username),{pos:r,above:!0,strictSide:!0,arrow:!0,create:()=>{const o=document.createElement("div");return o.className="cm-tooltip-cursor",o.textContent=s,{dom:o}}}})}const hs=Nn.baseTheme({".cm-tooltip.cm-tooltip-cursor":{backgroundColor:"#66b",color:"white",border:"none",padding:"2px 7px",borderRadius:"4px",zIndex:"10","& .cm-tooltip-arrow:before":{borderTopColor:"#66b"},"& .cm-tooltip-arrow:after":{borderTopColor:"transparent"}}});function xs(){const{users:e,currentUser:n}=T(),{activeFile:s,setActiveFile:r}=G(),{theme:o,language:a,fontSize:d}=q(),{socket:c}=M(),{viewHeight:l}=P(),[u,h]=i.useState(setTimeout(()=>{},0)),g=i.useMemo(()=>e.filter(y=>y.username!==n.username),[e,n]),[f,m]=i.useState([]),p=(y,S)=>{var A,L,Y;if(!s)return;const N={...s,content:y};r(N);const _=(Y=(L=(A=S.state)==null?void 0:A.selection)==null?void 0:L.main)==null?void 0:Y.head;c.emit(C.TYPING_START,{cursorPosition:_}),c.emit(C.FILE_UPDATED,{fileId:s.id,newContent:y}),clearTimeout(u);const O=setTimeout(()=>c.emit(C.TYPING_PAUSE),1e3);h(O)};return fs(),i.useEffect(()=>{const y=[fn,pn,ps(g),hs,Sn()],S=hn(a.toLowerCase());S?y.push(S):k.error("Syntax highlighting is unavailable for this language. Please adjust the editor settings; it may be listed under a different name.",{duration:5e3}),m(y)},[g,a]),t.jsx(xn,{theme:He[o],onChange:p,value:s==null?void 0:s.content,extensions:f,minHeight:"100%",maxWidth:"100vw",style:{fontSize:d+"px",height:l,position:"relative"}})}const we={php:"php",cs:"csharp"};function gs(){const{openFiles:e,closeFile:n,activeFile:s,updateFileContent:r,setActiveFile:o}=G(),a=i.useRef(null),{setLanguage:d}=q(),c=l=>{if((s==null?void 0:s.id)===l)return;r((s==null?void 0:s.id)||"",(s==null?void 0:s.content)||"");const u=e.find(h=>h.id===l);u&&o(u)};return i.useEffect(()=>{const l=a.current;if(!l)return;const u=h=>{h.deltaY>0?l.scrollLeft+=100:l.scrollLeft-=100};return l.addEventListener("wheel",u),()=>{l.removeEventListener("wheel",u)}},[]),i.useEffect(()=>{if((s==null?void 0:s.name)===void 0)return;const l=s.name.split(".").pop();if(!l)return;if(we[l]){d(we[l]);return}const u=ve.languages(l);d(u[0])},[s==null?void 0:s.name,d]),t.jsx("div",{className:"flex h-[50px] w-full select-none gap-2 overflow-x-auto p-2 pb-0",ref:a,children:e.map(l=>t.jsxs("span",{className:J("flex w-fit cursor-pointer items-center rounded-t-md px-2 py-1 text-white",{"bg-darkHover":l.id===(s==null?void 0:s.id)}),onClick:()=>c(l.id),children:[t.jsx(Ne,{icon:Ae(l.name),fontSize:22,className:"mr-2 min-w-fit"}),t.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:l.name,children:l.name}),t.jsx(ht,{className:"ml-3 inline rounded-md hover:bg-darkHover",size:20,onClick:()=>n(l.id)})]},l.id))})}function ws(){const{openFiles:e}=G(),{minHeightReached:n}=P();return e.length<=0?t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx("h1",{className:"text-xl text-white",children:"No file is currently open."})}):t.jsxs("main",{className:J("flex w-full flex-col overflow-x-auto md:h-screen",{"h-[calc(100vh-50px)]":!n,"h-full":n}),children:[t.jsx(gs,{}),t.jsx(xs,{})]})}function Cs(){const{viewHeight:e}=P(),{activityState:n}=T();return t.jsx("div",{className:"absolute left-0 top-0 w-full max-w-full flex-grow overflow-x-hidden md:static",style:{height:e},children:n===H.DRAWING?t.jsx(ds,{}):t.jsx(ws,{})})}function bs(){function e(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(r=>navigator.userAgent.match(r))}const n=e();i.useEffect(()=>{n&&fe.isEnabled&&fe.request()},[n])}function ys(){const{setUsers:e}=T(),{socket:n}=M(),s=i.useCallback(()=>{document.visibilityState==="visible"?n.emit(C.USER_ONLINE,{socketId:n.id}):document.visibilityState==="hidden"&&n.emit(C.USER_OFFLINE,{socketId:n.id})},[n]),r=i.useCallback(({socketId:d})=>{e(c=>c.map(l=>l.socketId===d?{...l,status:V.ONLINE}:l))},[e]),o=i.useCallback(({socketId:d})=>{e(c=>c.map(l=>l.socketId===d?{...l,status:V.OFFLINE}:l))},[e]),a=i.useCallback(({user:d})=>{e(c=>c.map(l=>l.socketId===d.socketId?d:l))},[e]);i.useEffect(()=>(document.addEventListener("visibilitychange",s),n.on(C.USER_ONLINE,r),n.on(C.USER_OFFLINE,o),n.on(C.TYPING_START,a),n.on(C.TYPING_PAUSE,a),()=>{document.removeEventListener("visibilitychange",s),n.off(C.USER_ONLINE),n.off(C.USER_OFFLINE),n.off(C.TYPING_START),n.off(C.TYPING_PAUSE)}),[n,e,s,r,o,a])}function Es(){var c;ys(),bs();const e=X(),{roomId:n}=wn(),{status:s,setCurrentUser:r,currentUser:o}=T(),{socket:a}=M(),d=je();return i.useEffect(()=>{var u;if(o.username.length>0)return;const l=(u=d.state)==null?void 0:u.username;if(l===void 0)e("/",{state:{roomId:n}});else if(n){const h={username:l,roomId:n};r(h),a.emit(C.JOIN_REQUEST,h)}},[o.username,(c=d.state)==null?void 0:c.username,e,n,r,a]),s===F.CONNECTION_FAILED?t.jsx(ls,{}):t.jsxs(as,{children:[t.jsx(us,{}),t.jsx(Cs,{})]})}const Ns=""+new URL("illustration-Azuc-YCm.svg",import.meta.url).href,vs=""+new URL("logo-Bk_XXpLN.svg",import.meta.url).href,js=()=>{var f,m;const e=je(),{currentUser:n,setCurrentUser:s,status:r,setStatus:o}=T(),{socket:a}=M(),d=i.useRef(null),c=X(),l=()=>{var p;s({...n,roomId:U()}),R.success("Created a new Room Id"),(p=d.current)==null||p.focus()},u=p=>{const y=p.target.name,S=p.target.value;s({...n,[y]:S})},h=()=>n.username.trim().length===0?(R.error("Enter your username"),!1):n.roomId.trim().length===0?(R.error("Enter a room id"),!1):n.roomId.trim().length<5?(R.error("ROOM Id must be at least 5 characters long"),!1):n.username.trim().length<3?(R.error("Username must be at least 3 characters long"),!1):!0,g=p=>{p.preventDefault(),r!==F.ATTEMPTING_JOIN&&h()&&(R.loading("Joining room..."),o(F.ATTEMPTING_JOIN),a.emit(C.JOIN_REQUEST,n))};return i.useEffect(()=>{var p;n.roomId.length>0||(p=e.state)!=null&&p.roomId&&(s({...n,roomId:e.state.roomId}),n.username.length===0&&R.success("Enter your username"))},[n,(f=e.state)==null?void 0:f.roomId,s]),i.useEffect(()=>{if(r===F.DISCONNECTED&&!a.connected){a.connect();return}const p=sessionStorage.getItem("redirect")||!1;if(r===F.JOINED&&!p){const y=n.username;sessionStorage.setItem("redirect","true"),c(`/editor/${n.roomId}`,{state:{username:y}})}else r===F.JOINED&&p&&(sessionStorage.removeItem("redirect"),o(F.DISCONNECTED),a.disconnect(),a.connect())},[n,(m=e.state)==null?void 0:m.redirect,c,o,a,r]),t.jsxs("div",{className:"flex w-full max-w-[500px] flex-col items-center justify-center gap-4 p-4 sm:w-[500px] sm:p-8",children:[t.jsx("img",{src:vs,alt:"Logo",className:"w-full"}),t.jsxs("form",{onSubmit:g,className:"flex w-full flex-col gap-4",children:[t.jsx("input",{type:"text",name:"roomId",placeholder:"Room Id",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:u,value:n.roomId}),t.jsx("input",{type:"text",name:"username",placeholder:"Username",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:u,value:n.username,ref:d}),t.jsx("button",{type:"submit",className:"mt-2 w-full rounded-md bg-primary px-8 py-3 text-lg font-semibold text-black",children:"Join"})]}),t.jsx("button",{className:"cursor-pointer select-none underline",onClick:l,children:"Generate Unique Room Id"})]})};function Ss(){return t.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center gap-16",children:t.jsxs("div",{className:"my-12 flex h-full min-w-full flex-col items-center justify-evenly sm:flex-row sm:pt-0",children:[t.jsx("div",{className:"flex w-full animate-up-down justify-center sm:w-1/2 sm:pl-4",children:t.jsx("img",{src:Ns,alt:"Code Sync Illustration",className:"mx-auto w-[250px] sm:w-[400px]"})}),t.jsx("div",{className:"flex w-full items-center justify-center sm:w-1/2",children:t.jsx(js,{})})]})})}const Ds=()=>t.jsxs(t.Fragment,{children:[t.jsx($e,{children:t.jsxs(Cn,{children:[t.jsx(me,{path:"/",element:t.jsx(Ss,{})}),t.jsx(me,{path:"/editor/:roomId",element:t.jsx(Es,{})})]})}),t.jsx(Dn,{})," "]});function Is({children:e}){return t.jsx(In,{children:t.jsx(Rn,{children:t.jsx(es,{children:t.jsx(is,{children:t.jsx(Yn,{children:t.jsx(Mn,{children:t.jsx(Kn,{children:t.jsx(Ln,{children:e})})})})})})})})}Je.createRoot(document.getElementById("root")).render(t.jsx(Is,{children:t.jsx(Ds,{})}));
